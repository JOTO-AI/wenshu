---
description: 'TypeScript å‰ç«¯å¼€å‘å’Œç»„ä»¶åº“é›†æˆè§„èŒƒ'
globs: ['**/*.tsx', '**/*.ts', '**/tsconfig.json', '**/vite.config.ts']
alwaysApply: true
---

# TypeScript å‰ç«¯å¼€å‘è§„èŒƒ

## ğŸš¨ æ ¸å¿ƒåŸåˆ™ï¼šé˜²æ­¢å¾ªç¯ä¾èµ–å’Œè·¯å¾„é”™è¯¯

**æœ¬è§„èŒƒåŸºäºå®é™…è¸©å‘ç»éªŒï¼Œå¿…é¡»ä¸¥æ ¼éµå¾ªï¼**

## ğŸ“ è·¯å¾„æ˜ å°„å’Œå¯¼å…¥è§„èŒƒ

### ç»å¯¹è·¯å¾„ vs ç›¸å¯¹è·¯å¾„ä½¿ç”¨è§„åˆ™

```typescript
// âœ… æ¨èï¼šåŒä¸€ç›®å½•å†…ç»„ä»¶ä½¿ç”¨ç›¸å¯¹è·¯å¾„
// æ–‡ä»¶ï¼šlibs/ui/src/components/ui/button.tsx
import { Input } from './input';
import { Card } from './card';

// âœ… æ¨èï¼šè·¨ç›®å½•ä½¿ç”¨ç›¸å¯¹è·¯å¾„
// æ–‡ä»¶ï¼šlibs/ui/src/components/ui/dialog.tsx
import { cn } from '../../lib/utils';

// âœ… æ¨èï¼šåº”ç”¨å±‚ä½¿ç”¨å·¥ä½œåŒºåˆ«å
// æ–‡ä»¶ï¼šapps/web-app/src/components/MyComponent.tsx
import { Button, Card } from '@wenshu/ui';
```

### âŒ ç¦æ­¢çš„å¯¼å…¥æ¨¡å¼

```typescript
// âŒ ç¦æ­¢ï¼šåœ¨åº“å†…éƒ¨ä½¿ç”¨ @/ è·¯å¾„åˆ«å
// è¿™ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–å’Œæ„å»ºé”™è¯¯
import { Button } from '@/components/ui/button'; // åœ¨ libs/ui å†…éƒ¨

// âŒ ç¦æ­¢ï¼šè·¨å·¥ä½œåŒºç›´æ¥è·¯å¾„å¯¼å…¥
// æ–‡ä»¶ï¼šapps/web-app/src/components/MyComponent.tsx
import { Button } from '../../../libs/ui/src/components/ui/button';

// âŒ ç¦æ­¢ï¼šæ··åˆä½¿ç”¨ä¸åŒçš„å¯¼å…¥é£æ ¼
import { Button } from './button';
import { Card } from '@/components/ui/card'; // åŒä¸€æ–‡ä»¶å†…ä¸è¦æ··ç”¨
```

## ğŸ”§ ç»„ä»¶åº“å¼€å‘è§„èŒƒ

### shadcn-ui ç»„ä»¶é›†æˆè§„èŒƒ

**å®‰è£…åå¿…é¡»æ£€æŸ¥çš„é…ç½®é¡¹ï¼š**

1. **components.json é…ç½®**

```json
{
  "aliases": {
    "components": "@/components", // âš ï¸ è¿™ä¸ªåœ¨åº“å†…éƒ¨ä¸ä½¿ç”¨
    "utils": "@/lib/utils" // âš ï¸ åº“å†…éƒ¨ç”¨ç›¸å¯¹è·¯å¾„
  }
}
```

2. **æ‰¹é‡ä¿®å¤å¯¼å…¥è·¯å¾„è„šæœ¬**

```bash
# ä¿®å¤æ‰€æœ‰ @/ å¯¼å…¥ä¸ºç›¸å¯¹è·¯å¾„
find libs/ui/src/components/ui -name "*.tsx" -exec sed -i '' 's|@/components/ui/|./|g' {} \;
find libs/ui/src/components/ui -name "*.tsx" -exec sed -i '' 's|@/lib/utils|../../lib/utils|g' {} \;
```

### Assistant UI é›†æˆè§„èŒƒ

```typescript
// âœ… æ­£ç¡®çš„ Assistant UI ä½¿ç”¨æ–¹å¼
import { Thread, AssistantRuntimeProvider } from '@assistant-ui/react';
import { useChatRuntime } from '@assistant-ui/react-ai-sdk';

function ChatPage() {
  const runtime = useChatRuntime({
    // é…ç½®é€‰é¡¹
  });

  return (
    <AssistantRuntimeProvider runtime={runtime}>
      <Thread />
    </AssistantRuntimeProvider>
  );
}

// âŒ ç¦æ­¢ï¼šé‡å¤é€ è½®å­
// ä¸è¦åˆ›å»º ChatInterface, Message, Composer ç­‰ç»„ä»¶
```

## ğŸ› ï¸ å¼€å‘æµç¨‹æ£€æŸ¥æ¸…å•

### æ¯æ¬¡ä¿®æ”¹ä»£ç åå¿…é¡»æ‰§è¡Œï¼š

1. **ç±»å‹æ£€æŸ¥**

```bash
pnpm exec nx typecheck @wenshu/web-app
```

2. **æ„å»ºéªŒè¯**

```bash
pnpm exec nx build @wenshu/web-app
```

3. **è·¯å¾„å¯¼å…¥æ£€æŸ¥**

```bash
# æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯çš„ @/ å¯¼å…¥
grep -r "@/" libs/ui/src/components/ui/ --include="*.tsx"
# è¾“å‡ºåº”è¯¥ä¸ºç©º
```

### æ·»åŠ æ–°ç»„ä»¶æ—¶çš„æ£€æŸ¥æ¸…å•ï¼š

- [ ] æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„å¯¼å…¥è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰ï¼Ÿ
- [ ] æ˜¯å¦é¿å…äº†å¾ªç¯ä¾èµ–ï¼Ÿ
- [ ] æ˜¯å¦æ›´æ–°äº† `libs/ui/src/index.ts` çš„å¯¼å‡ºï¼Ÿ
- [ ] æ˜¯å¦è¿è¡Œäº†ç±»å‹æ£€æŸ¥å’Œæ„å»ºéªŒè¯ï¼Ÿ
- [ ] æ˜¯å¦éµå¾ªäº†ç°æœ‰çš„ç»„ä»¶ç»“æ„æ¨¡å¼ï¼Ÿ

## ğŸ“¦ å·¥ä½œåŒºæ¶æ„è§„èŒƒ

### ä¾èµ–å…³ç³»è§„åˆ™

```
apps/web-app           â†’ å¯ä»¥ä¾èµ– libs/*
libs/ui               â†’ å¯ä»¥ä¾èµ– å…¶ä»– libsï¼ˆé¿å…å¾ªç¯ï¼‰
libs/shared-types     â†’ çº¯ç±»å‹åº“ï¼Œä¸ä¾èµ–å…¶ä»– libs
libs/api-client       â†’ å¯ä»¥ä¾èµ– libs/shared-types
```

### tsconfig.json é…ç½®æ ‡å‡†

```json
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@wenshu/ui": ["libs/ui/src/index.ts"],
      "@wenshu/shared-types": ["libs/shared-types/src/index.ts"],
      "@wenshu/api-client": ["libs/api-client/src/index.ts"]
    }
  }
}
```

## ğŸš¨ å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### é”™è¯¯ 1: "Cannot apply unknown utility class"

**åŸå› **: Tailwind CSS v4 å…¼å®¹æ€§é—®é¢˜
**è§£å†³**: ä½¿ç”¨ CSS å±æ€§è€Œä¸æ˜¯ `@apply`

```css
/* âŒ é”™è¯¯ */
@apply border-border;

/* âœ… æ­£ç¡® */
border-color: hsl(var(--border));
```

### é”™è¯¯ 2: "Cannot find module '@assistant-ui/react'"

**åŸå› **: ä¾èµ–æœªå®‰è£…åˆ°æ­£ç¡®çš„å·¥ä½œåŒº
**è§£å†³**:

```bash
cd apps/web-app
pnpm add @assistant-ui/react @assistant-ui/react-ai-sdk
```

### é”™è¯¯ 3: å¾ªç¯ä¾èµ–é”™è¯¯

**åŸå› **: ç»„ä»¶å†…éƒ¨ä½¿ç”¨äº† @/ è·¯å¾„åˆ«å
**è§£å†³**: ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯¼å…¥

```typescript
// âŒ é”™è¯¯
import { Button } from '@/components/ui/button';

// âœ… æ­£ç¡®
import { Button } from './button';
```

### é”™è¯¯ 4: "Failed to fetch dynamically imported module"

**åŸå› **: è¿è¡Œæ—¶è·¯å¾„è§£æé”™è¯¯
**è§£å†³**: æ£€æŸ¥ Vite é…ç½®å’Œè·¯å¾„åˆ«åè®¾ç½®

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. å¿«é€Ÿè¯Šæ–­å¯¼å…¥é—®é¢˜

```bash
# æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„é—®é¢˜å¯¼å…¥
find . -name "*.tsx" -o -name "*.ts" | xargs grep -l "@/" | grep -E "(libs/ui|libs/)"
```

### 2. æ£€æŸ¥ä¾èµ–å…³ç³»

```bash
# ä½¿ç”¨ Nx å¯è§†åŒ–ä¾èµ–å›¾
nx graph
```

### 3. éªŒè¯æ„å»ºäº§ç‰©

```bash
# æ£€æŸ¥æ„å»ºåçš„æ–‡ä»¶ç»“æ„
ls -la apps/web-app/dist/
ls -la libs/ui/dist/
```

## ğŸ“š æœ€ä½³å®è·µç¤ºä¾‹

### åˆ›å»ºæ–°çš„ UI ç»„ä»¶

```typescript
// æ–‡ä»¶ï¼šlibs/ui/src/components/ui/my-component.tsx
import * as React from 'react';
import { cva, type VariantProps } from 'class-variance-authority';
import { cn } from '../../lib/utils';
import { Button } from './button'; // ç›¸å¯¹è·¯å¾„

const myComponentVariants = cva('base-styles', {
  variants: {
    variant: {
      default: 'default-styles',
      secondary: 'secondary-styles',
    },
  },
  defaultVariants: {
    variant: 'default',
  },
});

export interface MyComponentProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof myComponentVariants> {
  // ç»„ä»¶ç‰¹å®šçš„ props
}

const MyComponent = React.forwardRef<HTMLDivElement, MyComponentProps>(
  ({ className, variant, ...props }, ref) => {
    return (
      <div
        ref={ref}
        className={cn(myComponentVariants({ variant }), className)}
        {...props}
      />
    );
  }
);

MyComponent.displayName = 'MyComponent';

export { MyComponent, myComponentVariants };
```

### æ›´æ–°å¯¼å‡ºæ–‡ä»¶

```typescript
// æ–‡ä»¶ï¼šlibs/ui/src/index.ts
export { MyComponent, myComponentVariants } from './components/ui/my-component';
export type { MyComponentProps } from './components/ui/my-component';
```

## ğŸ¯ è´¨é‡ä¿è¯

### è‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# æ–‡ä»¶ï¼šscripts/quality-check.sh

echo "ğŸ” æ£€æŸ¥è·¯å¾„å¯¼å…¥..."
WRONG_IMPORTS=$(find libs/ui/src/components/ui -name "*.tsx" -exec grep -l "@/" {} \;)
if [ ! -z "$WRONG_IMPORTS" ]; then
  echo "âŒ å‘ç°é”™è¯¯çš„å¯¼å…¥è·¯å¾„ï¼š"
  echo "$WRONG_IMPORTS"
  exit 1
fi

echo "âœ… è·¯å¾„æ£€æŸ¥é€šè¿‡"

echo "ğŸ” è¿è¡Œç±»å‹æ£€æŸ¥..."
pnpm exec nx typecheck @wenshu/web-app || exit 1

echo "ğŸ” è¿è¡Œæ„å»ºæ£€æŸ¥..."
pnpm exec nx build @wenshu/web-app || exit 1

echo "ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼"
```

---

**è®°ä½ï¼šè¿™äº›è§„èŒƒæ˜¯åŸºäºå®é™…è¸©å‘ç»éªŒæ€»ç»“çš„ï¼Œä¸¥æ ¼éµå¾ªå¯ä»¥é¿å… 90% çš„å¸¸è§é”™è¯¯ï¼**
